<%@ page import="com.bean.TaskBean" %>
<%@ page import="com.service.fragService.FragService" %>
<%@ page import="com.util.tools.CheckTools" %>
<%@ page import="java.util.regex.Pattern" %>
<%@ page import="java.util.regex.Matcher" %>
<%@ page import="java.text.SimpleDateFormat" %>
<%@ page import="java.util.Date" %>
<%@ page import="java.util.Map" %>
<%@ page import="java.util.List" %>
<%@ page import="com.util.tools.ReadWriteProperties" %>
<%@ page import="com.util.tools.StaticUtil" %>
<%@ page contentType="text/html;charset=UTF-8" pageEncoding="utf-8" language="java" %>
<%@ page import="com.util.tools.ToolUtil" %>
<%@ page import="com.service.Service.loginDetection.LoginDetection" %>
<%@ page import="com.service.Service.UserService.UserService" %>
<%@ page import="com.service.Service.ComHtmlHandler" %>
<%@ page import="com.service.Service.Bbs.BbsMcenterLeftService" %>
<%
    String ip=ToolUtil.getClientIp(request);
    int status= LoginDetection.getInstance().loginCheck(request.getCookies(),ip,response);
    if (status==1){
        return;
    }
    String user_id = UserService.getInstance().getUidFromCookie(request);
    String curPage = request.getParameter("page");
    String curPage2 = request.getParameter("page2");
    int curP = 1;
    int curP2 = 1;
    if (CheckTools.checkPositiveNum(curPage)) {
        curP = Integer.parseInt(curPage);
    }
    if (CheckTools.checkPositiveNum(curPage2)) {
        curP2 = Integer.parseInt(curPage2);
    }

    String[] param = {user_id};
    TaskBean t = new TaskBean(38, 0, param);
    String json1 = FragService.getInstance().fragment(0, t);

        List<Map<String, String>> list = StaticUtil.objectMapper.readValue(json1, List.class);
    String tou = "";
    String ni = "";
    String bei = "";
    for (Map<String, String> map : list) {
        tou = map.get("avatar");
        ni = map.get("nick");
        bei = map.get("remark");
    }
    String fragPath = request.getSession().getServletContext().getRealPath("/frag");
%>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
    <meta content="black" name="apple-mobile-web-app-status-bar-style" />
    <meta name="keywords" http-equiv="keywords" content="8673h,专业的汽车配件交易网,精准的车型数据库查询平台,找配件,买配件,卖配件,企商汇,机油,电瓶,火花塞,养护品,刹车片,雨刷,滤清器,皮带,防冻液,保险杠,中网,倒车镜,钣金件,水箱,冷凝器,电子扇...国内最专业最全面的汽配在线交易查询网" />
    <meta name="description" http-equiv="description" content="8673h.com-浙江企商汇电子商务有限公司-提供最精准最专业的配件查询数据库,VIN码,OEM码,适用车型,配件分类,配件品牌等多种查询,旨在解决找配件查询难,让你方便快捷的找到最想要的配件,盘活汽配生产商,汽配经销商,4S店,修理厂积压的呆滞件,事故件,易损件,拆车件,原厂件库存" />
    <title>个人中心-我的回复-浙江企商汇电子商务有限公司</title>
    <link type="image/x-icon" href="../favicon.ico" mce_href="favicon.ico" rel="shortcut icon"/>
    <link type="text/css" href="../css/body.css" rel="stylesheet"/>
    <link type="text/css" href="../css/head.css" rel="stylesheet"/>
    <link type="text/css" href="../font/iconfont.css" rel="stylesheet" >
    <link type="text/css" href="../css/foot.css" rel="stylesheet"/>
    <link type="text/css" href="../css/pager.css" rel="stylesheet"/>
    <link type="text/css" href="../font/iconfont.css" rel="stylesheet" >
    <link type="text/css" href="../css/wodetiezi.css" rel="stylesheet" />
</head>

<body>
<%
    out.write(ComHtmlHandler.getInstance().htmlHandler(4));
    out.flush();
%>
<div class="max_width">
    <div class="bodd">
        <%
            BbsMcenterLeftService left = BbsMcenterLeftService.getInstance();
            out.write(left.makeLeft(fragPath + "/p-center_left.txt", tou, ni, bei));
            out.flush();
        %>
        <div class="you left_float">
            <div class="you1">
                <p class="ppl"> <i class="iconfont" style="font-size:18px">&#xe60d;</i> <strong>我的回复</strong></p>
            </div>
            <div class="you2">
                <table width="100%" border="0" cellspacing="0" cellpadding="0" class="huit">
                    <col class="tian">
                    <col class="tian1">
                    <col class="tian1">
                    <col>
                    <tr>
                        <th class="text-left padding10 yel"><i class="iconfont">&#xe614;</i> 我回复的</th>
                        <th>所属版块</th>
                        <th>点击/回复</th>
                        <th>回复时间</th>
                    </tr>
                   <%
                       int page1 = curP;
                       int row1 = 5;//pagesize
                       int taskId = 302;
                       int cmdType = 1;
                       String[] params = {user_id};
                       TaskBean taskBean = new TaskBean(taskId, cmdType, page1, row1, params);
                       String jsonTypeData = FragService.getInstance().fragment(10, fragPath + "/p-center_myreply2other.txt", taskBean, "myreply2other");
                       String[] a=jsonTypeData.split("###cococoforsplit###");
                       for(int i=1;i<a.length;i++){
                           Pattern p= Pattern.compile("(?<=<td>)#1#:cococo1.*#1#(?=</td>)");
                           Matcher m=p.matcher(a[i]);
                           while (m.find()){
                               StringBuffer buffer=new StringBuffer();
                               String k=m.group().substring(11,m.group().length()-3);
                               SimpleDateFormat sd1=new SimpleDateFormat("yyyy-MM-dd ,HH:mm:ss");
                               Date today=new Date();
                               String today1=sd1.format(today).split(",")[0];
                               Date b=new Date(Long.parseLong(k));
                               String dateofdb=sd1.format(b);//2014-05-04,13:15:16
                               if(dateofdb.split(",")[0].equals(today1)){
                                   buffer.append(dateofdb.split(",")[1]);
                               }else{
                                   buffer.append(dateofdb.split(",")[0]);
                               }
                               a[i]=a[i].replaceAll("(?<=<td>)#1#:cococo1.*#1#(?=</td>)",buffer.toString());
                           }
                       }
                       StringBuffer sb=new StringBuffer();
                       for(int i=0;i<a.length;i++){
                           sb.append(a[i]);
                       }
                       out.write(sb.toString());
                       out.flush();
                    %>
                    <tr>
                        <td colspan="4" style="border:none; padding:10px 0;">
                            <form>
                                <input type="hidden" name="curPage1" id="curPage1" value="<%=curP%>>"/>
                                <input type="hidden" name="pageSize1" id="pageSize1" value="<%=row1%>"/>
                            </form>
                            <div class="allgoodslist right_f">
                                <div class="divPagePanel" ></div>
                                <div class="tiaozhuan">
                                    <ul>
                                        <li>到第<input type="text" id="goPage1" value="<%=curP%>"/>页</li>
                                        <li class="queding"><a href="javascript:void(0) " id="gopp1">确&nbsp;定</a></li>
                                        <div class="clear"></div>
                                    </ul>
                                </div>
                                <div class="clear"></div>
                            </div>
                        </td>
                    </tr>
                </table>
                <table width="100%" border="0" cellspacing="0" cellpadding="0" class="huit">
                    <col class="huifu_width">
                    <col class="tian1">
                    <tr>
                        <th class="text-left padding10 red"><i class="iconfont">&#xe613;</i> 回复我的</th>
                        <th>回复时间</th>
                    </tr>
                    <%  int page2 = curP2;
                        int row2 = 2;//pagesize
                        String fragPath2 = request.getSession().getServletContext().getRealPath("/frag");
                        int taskId2 = 303;
                        int cmdType2 = 1;
                        String[] params2 = {user_id};
                        TaskBean taskBean2 = new TaskBean(taskId2, cmdType2, page2, row2, params2);
                        String jsonTypeData2 = FragService.getInstance().fragment(10, fragPath2 + "/p-center_otherreply2me.txt", taskBean2, "otherreply2me");
                        String[] b=jsonTypeData2.split("###cococoforsplit###");
                        for(int i=1;i<b.length;i++){
                            //对日期格式转换
                            Pattern p= Pattern.compile("(?<=<div class=\"hui_fu_r\">)#0#:cococo0.*#0#(?=</div>)");
                            Matcher m=p.matcher(b[i]);
                            while (m.find()){
                                StringBuffer buffer2=new StringBuffer();
                                String k=m.group().substring(11,m.group().length()-3);
                                SimpleDateFormat sd1=new SimpleDateFormat("yyyy-MM-dd ,HH:mm:ss");
                                Date today=new Date();
                                String today1=sd1.format(today).split(",")[0];
                                Date b2=new Date(Long.parseLong(k));
                                String dateofdb=sd1.format(b2);//2014-05-04,13:15:16
                                if(dateofdb.split(",")[0].equals(today1)){
                                    buffer2.append(dateofdb.split(",")[1]);
                                }else{
                                    buffer2.append(dateofdb.split(",")[0]);
                                }
                                b[i]=b[i].replaceAll("(?<=<div class=\"hui_fu_r\">)#0#:cococo0.*#0#(?=</div>)",buffer2.toString());
                            }
                            //对回复内容转换
                            Pattern p2= Pattern.compile("(?<=<div class=\"zhishu\">)#1#:cococo1.*#1#(?=</div>)");
                            Matcher m2=p2.matcher(b[i]);
                            while(m2.find()){
                                String s2=null;
                                //如果内容长度大于31
                                String newstring =m2.group().substring(11,m2.group().length()-3);
                                 if(newstring.length()>31){
                                     s2=newstring.substring(0,30)+"...";
                                 }else{
                                     s2=newstring;
                                 }
                                b[i]=b[i].replaceAll("(?<=<div class=\"zhishu\">)#1#:cococo1.*#1#(?=</div>)",s2);
                            }
                         }
                        StringBuffer sb2=new StringBuffer();
                        for(int i=0;i<b.length;i++){
                            sb2.append(b[i]);
                        }
                        out.write(sb2.toString());
                        out.flush();
                    %>
                    <tr>
                        <td colspan="4" style="border:none; padding:10px 0;">
                            <form>
                                <input type="hidden" name="curPage2" id="curPage2" value="<%=curP2%>"/>
                                <input type="hidden" name="pageSize2" id="pageSize2" value="<%=row2%>"/>
                            </form>
                            <div class="allgoodslist right_f">
                                <div class="divPagePanel" ></div>
                                <div class="tiaozhuan">
                                    <ul>
                                        <li>到第<input type="text" id="goPage2" value="<%=curP2%>" />页</li>
                                        <li class="queding"><a href="javascript:void(0)" id="gopp2">确&nbsp;定</a></li>
                                        <div class="clear"></div>
                                    </ul>
                                </div>
                                <div class="clear"></div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td colspan="4" class="pzxxx" style="border:none; padding:10px 0;">
                            严禁在论坛中传播违法不良信息，违反者立即删除帖子，屡教不改者将封停账号！请您配合。
                        </td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
</div>
<%
    out.write(ComHtmlHandler.getInstance().htmlHandler(3));
    out.flush();
%>
<body/>
<script type="text/javascript" src="../js/jquery.min.js" charset="utf-8"></script>
<script type="text/javascript" src="../js/page.js" charset="utf-8"></script>
<script type="text/javascript" src="../js/jquery.cookie.js" charset="utf-8"></script>
<script type="text/javascript" src="../js/head.js" charset="utf-8"></script>
<script type="text/javascript" src="../js/jquery.cookie.js" charset="utf-8"></script>
<script type="text/javascript">
    //搜索
    $(".list").hover(function(){
                $(this).addClass("hover");
                $(this).find("i").each(function(index, element) {
                    $(this).hasClass("dis_none")? $(this).removeClass("dis_none"):$(this).addClass("dis_none");
                });
            },function(){
                $(this).removeClass("hover");
                $(this).find("i").each(function(index, element) {
                    $(this).hasClass("dis_none")? $(this).removeClass("dis_none"):$(this).addClass("dis_none");
                });
            }
    );
    $(".ming li").each(function(index, element) {
        $(this).click(function(){
            var index=$(this).index();
            var bbj=$(".ming li").eq(0).text();
            var btr=$(".ming li").eq(0).attr("data-id");
            var abj=$(this).text();
            var atr=$(this).attr("data-id");
            if(index != 0){
                $(".ming li").eq(0).text(abj);
                $(".ming li").eq(0).attr("data-id",atr);
                $(".ming li").eq(1).text(bbj);
                $(".ming li").eq(1).attr("data-id",btr);
            }
        });
    });
    $("#huifu").addClass("aver");
<!--分页代码 -->
    $(document).ready(function(){
        var curpage=parseInt($("#curPage1").val());
        var pageSize=parseInt($("#pageSize1").val());
        var itemCount=parseInt($("#itemCount1").val());
        var Hhtml = MyPager.printPage(curpage,pageSize,itemCount,1);
        var Hhtml2 = MyPager.printPage(parseInt($("#curPage2").val()),parseInt($("#pageSize2").val()),parseInt($("#itemCount2").val()),{type:2});
        $(".divPagePanel:eq(0)").html(Hhtml);
        $(".divPagePanel:eq(1)").html(Hhtml2);
    });
    function pageClick(action,type){
        var curpage1 = parseInt($("#curPage1").val());
        var curpage2 = parseInt($("#curPage2").val());
        type == 1 ? curpage1 = parseInt($("#curPage1").val()):curpage2 = parseInt($("#curPage2").val());
        if(action == "minus"){
            type == 1 ? curpage1 = curpage1 - 1:curpage2 = curpage2 - 1;
            //curpage = curpage - 1;
        } else if(action == "add"){
            type == 1 ? curpage1 = curpage1 + 1:curpage2 = curpage2 + 1;
        } else {
            type == 1 ? curpage1 = action:curpage2 = action;
        }
        window.location.href="/p-center/myreply.jsp?page="+ curpage1 +"&page2=" + curpage2;
    }
    $("#gopp1").click (function(){
        var ppage1=$("#goPage1").val().trim();
        var curpage2 = parseInt($("#curPage2").val());
        var reg = /^(0|[1-9][0-9]*)$/;
        if(!reg.test(ppage1)){
            alert("无效的页码");
            return false;
        }
        var row1=<%=row1%>;
        var itemCount=parseInt($("#itemCount1").val());
        if(ppage1>Math.ceil(itemCount / row1)){
            alert("超过总页码"+Math.ceil(itemCount / row1));
            return false;
        }

        window.location.href="/p-center/myreply.jsp?page="+ppage1+"&page2=" + curpage2;
    })
    $("#gopp2").click (function(){
        var curpage1 = parseInt($("#curPage1").val());
        var ppage2=$("#goPage2").val().trim();
        var reg = /^(0|[1-9][0-9]*)$/;
        if(!reg.test(ppage2)){
            alert("无效的页码");
            return false                                    ;
        }
        var row2=<%=row2%>;
        var itemCount=parseInt($("#itemCount2").val());
        if(ppage2>Math.ceil(itemCount / row2)){
            alert("超过总页码"+Math.ceil(itemCount / row2));
            return false;
        }
        window.location.href="/p-center/myreply.jsp?page="+curpage1+"&page2=" + ppage2;
    })

</script>