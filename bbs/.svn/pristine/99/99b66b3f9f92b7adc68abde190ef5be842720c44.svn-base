<%@ page import="com.bean.TaskBean" %>
<%@ page import="com.service.fragService.FragService" %>
<%@ page import="java.util.regex.Pattern" %>
<%@ page import="java.util.regex.Matcher" %>
<%@ page import="java.text.SimpleDateFormat" %>
<%@ page import="java.util.Date" %>
<%@ page import="java.util.GregorianCalendar" %>
<%@ page import="java.util.Calendar" %>
<%@ page import="java.util.List" %>
<%@ page import="java.util.Map" %>
<%@ page import="com.util.tools.ReadWriteProperties" %>
<%@ page import="com.util.tools.ToolUtil" %>
<%@ page import="com.util.tools.StaticUtil" %>
<%@ page import="com.service.Service.ComHtmlHandler" %>
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<%
    ReadWriteProperties rwp = ReadWriteProperties.getInstance();
    //参数形式，别的地方也要跳转
    String user_id = request.getParameter("cID");
    if (null == user_id || "".equals(user_id)) {
        response.sendRedirect("/error/400.html");
        return;
    }
    //获取个人信息
    int taskId = 21;
    int cmdType = 0;
    String[] params = {user_id};
    TaskBean taskBean = new TaskBean(taskId, cmdType, params);
    String json1 = FragService.getInstance().fragment(0, taskBean);

    List<Map<String, String>> list = StaticUtil.objectMapper.readValue(json1, List.class);
    String nick="无昵称",avatar="",posts="0",replies="0",bests="0",points="0",reg_time="";
    String serverCache = rwp.readValue("config", "server");
    if (list.size() == 1) {//赋值
        for (Map<String, String> map : list) {
            nick = map.get("nick");//昵称
            avatar = map.get("avatar");//头像
            if ("".equals(avatar)) {
                avatar = rwp.readValue("config", "user_img");
            } else {
                avatar = serverCache + avatar;
            }
            posts = map.get("posts");//发帖数
            replies = map.get("replies");//回贴数
            bests = map.get("bests");//加精
            points = ToolUtil.pointChinese(map.get("points"),rwp,StaticUtil.objectMapper);//积分
            reg_time = map.get("reg_time");//注册时间
        }
    }
%>
<!DOCTYPE html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>企商论坛-买汽配-卖汽配-汽商汇-浙江企商汇电子商务有限公司</title>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
    <meta content="black" name="apple-mobile-web-app-status-bar-style" />
    <meta name="keywords" http-equiv="keywords" content="8673h,专业的汽车配件交易网,精准的车型数据库查询平台,找汽配,汽商汇,买汽配,卖汽配,企商汇,机油,电瓶,火花塞,养护品,刹车片,雨刷,滤清器,防冻液-国内最专业最全面的汽配在线交易查询网"/>
    <meta name="description" http-equiv="description" content="8673h.com-浙江企商汇电子商务有限公司-提供最精准最专业的配件查询数据库,VIN码,OEM码,适用车型,配件分类,配件品牌等多种查询,旨在解决找配件查询难,让你方便快捷的找到最想要的配件,盘活汽配生产商,汽配经销商,4S店,修理厂积压的呆滞件,事故件,易损件,拆车件,原厂件库存" />
    <link type="image/x-icon" href="../favicon.ico" mce_href="/favicon.ico" rel="shortcut icon"/>
    <link type="text/css" href="../css/shared.css" rel="stylesheet"/>
    <link href="../css/head.css" rel="stylesheet" type="text/css" />
    <link href="../font/iconfont.css" rel="stylesheet" type="text/css"/>
    <link type="text/css" rel="stylesheet" href="../css/pager.css" />
    <link href="../css/foot.css" rel="stylesheet" type="text/css" />
    <link href="../js/kindeditor/themes/default/default.css" rel="stylesheet" type="text/css"/>
    <link href="../css/userinfo.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<%
    out.write(ComHtmlHandler.getInstance().htmlHandler(4));
    out.flush();
%>
<div class="max_width">
    <div class=" fenleihead">Ta的信息</div>
    <div class="bodycenter">
        <div class="left ">
            <h4><a href="javascript:void(0);"><%=nick%></a></h4>
            <div class="user-headimg">
                <a href="javascript:void(0);" target="_blank"><img src="<%=avatar%>" width="120" height="120" /></a>
            </div>
            <ul class="user-info">
                <li>等级：<a href="javascript:void(0);"><%=points%></a></li>
                <li>精华：<a href="javascript:void(0);"><strong><%=bests%>帖</strong></a></li>
                <li>帖子：<a href="javascript:void(0);"><%=posts%>帖</a> | <a href="javascript:void(0);"><%=replies%>回</a></li>
                <li>注册：<span><%=reg_time%></span></li>

            </ul>
        </div>
        <div class="right">
            <div class="centerpart">
                <ul class="postState">
                    <li class="select"><a href="javascript:void(0);">他的帖子</a></li>
                </ul>
                <table>
                    <thead>
                    <tr>
                        <th class="subject">主题</th>
                        <th class="later">发表</th>
                        <th class="score">回复/点击</th>
                        <th class=" last">最后回复</th>
                    </tr>
                    </thead>
                    <tbody>
                    <%
                        String curPage = request.getParameter("page");
                        int curP = 1;
                        if (null != curPage && Integer.parseInt(curPage) >= 0) {
                            curP = Integer.parseInt(curPage);
                        }
                        String type = request.getParameter("type");
                        int page1 = curP;
                        int row = 4;
                        String[] param = new String[]{user_id};
                        taskBean = new TaskBean(20, 1, page1, row, param);
                        String fragPath = request.getSession().getServletContext().getRealPath("/frag");
                        String json = FragService.getInstance().fragment(0, fragPath + "/index_tiezi.txt", taskBean, "tiezi");
                        Pattern pattern = Pattern.compile("###zhong:(.*?)###");
                        Matcher matcher = pattern.matcher(json);
                        String str = null;
                        String str1 = null;
                        while (matcher.find()) {
                            str1 = matcher.group();//匹配部分，最后替换掉
                            str = matcher.group(1);//匹配的值
                            if (str.equals("1")) {
                                str = "<img src=\"../images/post.png\" alt=\"普通帖\"/>";
                            } else if (str.equals("2")) {
                                str = "<img src=\"../images/vote.png\" alt=\"投票帖\"/>";
                            } else if (str.equals("3")) {
                                str = "<img src=\"../images/post.png\" alt=\"图文帖\"/>";
                            } else {
                                str = "<img src=\"../images/post.png\" alt=\"普通帖\"/>";
                            }
                            json = json.replaceFirst(str1, str);
                        }
                        pattern = Pattern.compile("###jing:(.*?)###");
                        matcher = pattern.matcher(json);
                        while (matcher.find()) {
                            str1 = matcher.group();//匹配部分，最后替换掉
                            str = matcher.group(1);//匹配的值
                            if (str.equals("0")) {
                                str = "";
                            } else if (str.equals("1")) {
                                str = "<img src=\"../images/official_best.png\" alt=\"类目精华帖\" />";
                            }
                            json = json.replaceFirst(str1, str);
                        }
                        pattern = Pattern.compile("###suo:(.*?)###");
                        matcher = pattern.matcher(json);
                        while (matcher.find()) {
                            str1 = matcher.group();//匹配部分，最后替换掉
                            str = matcher.group(1);//匹配的值
                            if (str.equals("0")) {
                                str = "";
                            } else if (str.equals("1")) {
                                str = "<img src=\"../images/post_lock.png\" alt=\"内容锁定\"/>";
                            }
                            json = json.replaceFirst(str1, str);
                        }
                        pattern = Pattern.compile("###shijian:(.*?)###");
                        matcher = pattern.matcher(json);
                        SimpleDateFormat sdf1 = new SimpleDateFormat("yyyy-MM-dd");// HH:mm:ss:SSS
                        Date d = new Date();
                        GregorianCalendar gc = new GregorianCalendar();
                        gc.setTime(d);
                        gc.set(Calendar.HOUR,-12);
                        gc.set(Calendar.MINUTE,0);
                        gc.set(Calendar.SECOND,0);
                        gc.set(Calendar.MILLISECOND,0);
                        long toDay = gc.getTime().getTime();
                        while (matcher.find()) {
                            str1 = matcher.group();//匹配部分，最后替换掉
                            str = matcher.group(1);//匹配的值 毫秒数
                            if(!str.equals("")){
                                long shujushijian = Long.parseLong(str);
                                long res = toDay - shujushijian;
                                if (res <= 0) {//同一天，判断几秒前
                                    res = d.getTime() - shujushijian;
                                    if (0L != res / 1000 / 60 / 60) {
                                        str = res / 1000 / 60 / 60 + "小时前";
                                    } else if (0L != res / 1000 / 60) {
                                        str = res / 1000 / 60 + "分钟前";
                                    } else if (0L != res / 1000) {
                                        str = res / 1000 + "秒前";
                                    } else {
                                        str = "1秒前";
                                    }
                                } else {//不同天，显示年月日
                                    str = sdf1.format(new Date(shujushijian));
                                }
                            }
                            json = json.replaceFirst(str1, str);
                        }
                        out.write(json);
                        out.flush();
                    %>
                    </tbody>

                </table>
                <!--关于产品展示分页  放在alldoodslist外边 -->
                <form>
                    <input type="hidden" name="curPage" id="curPage" value="<%=curP%>"/>
                    <input type="hidden" name="pageSize" id="pageSize" value="<%=row%>"/>
                </form>
                <div class="allgoodslist">
                    <div style="float:left;" class="divPagePanel" ></div>
                    <div style="float:left;" class="tiaozhuan">
                        <ul>
                            <li>到第<input type="text"/>页</li>
                            <li class="queding"><a href="javascript:void(0);">确定</a></li>
                            <div class="clear"></div>
                        </ul>
                    </div>
                    <div class="clear"></div>
                </div>
            </div>


        </div>
    </div>

</div>
<%
    out.write(ComHtmlHandler.getInstance().htmlHandler(3));
    out.flush();
%>
<script type="text/javascript" src="/js/jquery.min.js" charset="utf-8"></script>
<script type="text/javascript" src="/js/jquery.cookie.js" charset="utf-8"></script>
<script type="text/javascript" src="/js/head.js" charset="utf-8"></script>
<script type="text/javascript" src="../js/page.js" charset="utf-8"></script>
<script type="text/javascript" src="../js/kindeditor/kindeditor-all.js" charset="utf-8"></script>
<script type="text/javascript" src="../js/kindeditor/lang/zh_CN.js" charset="utf-8"></script>
<script>
    //搜索
    $(".list").hover(function(){
                $(this).addClass("hover");
                $(this).find("i").each(function(index, element) {
                    $(this).hasClass("dis_none")? $(this).removeClass("dis_none"):$(this).addClass("dis_none");
                });
            },function(){
                $(this).removeClass("hover");
                $(this).find("i").each(function(index, element) {
                    $(this).hasClass("dis_none")? $(this).removeClass("dis_none"):$(this).addClass("dis_none");
                });
            }
    );
    $(".ming li").each(function(index, element) {
        $(this).click(function(){
            var index=$(this).index();
            var bbj=$(".ming li").eq(0).text();
            var btr=$(".ming li").eq(0).attr("data-id");
            var abj=$(this).text();
            var atr=$(this).attr("data-id");
            if(index != 0){
                $(".ming li").eq(0).text(abj);
                $(".ming li").eq(0).attr("data-id",atr);
                $(".ming li").eq(1).text(bbj);
                $(".ming li").eq(1).attr("data-id",btr);
            }
        });
    });
    $(document).ready(function(){
        <!--分页代码 -->
        var curpage=parseInt($("#curPage").val());
        var pageSize=parseInt($("#pageSize").val());
        var itemCount=parseInt($("#itemCount").val());
        var Hhtml = MyPager.printPage(curpage,pageSize,itemCount,1);
        $(".divPagePanel").html(Hhtml);
    });
    function pageClick(action){
        var curpage = parseInt($("#curPage").val());
        var pageSize = parseInt($("#pageSize").val());
        var itemCount = parseInt($("#itemCount").val());
        if (action == "minus") {
            curpage = curpage - 1;
        } else if (action == "add") {
            curpage = curpage + 1;
        } else {
            curpage = action;
        }
        window.location.href = "/p-center/suso-username.jsp?cID=<%=user_id%>&page="+curpage;
    }
    function dianJi(pID) {
        $.Bigo('/Action/JsonDispatcher.do',{taskId: '19', cmdType: 'Update',pID:pID}, {sucAction: function s(data){
            console.log(data);
        }});
    }
</script>
</body>
</html>

